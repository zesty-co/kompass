groups:
  - name: custom_rules
    rules:
      - record: kompass_container_cpu_usage_max_rate
        expr: max(rate(container_cpu_usage_seconds_total{container!="", pod!=""}[1m]) * on (pod, container) group_left (resource_id, created_by_name, created_by_kind, namespace) max(kompass_pod_info) by (container, pod, resource_id, created_by_name, created_by_kind, namespace)) by (container, resource_id, created_by_name, created_by_kind, namespace) or on (pod, container) max(kompass_pod_info) by (container, resource_id, created_by_name, created_by_kind, namespace) * 0
      - record: kompass_container_cpu_usage_p95_rate
        expr: quantile(0.95, rate(container_cpu_usage_seconds_total{container!="", pod!=""}[1m]) * on (pod, container) group_left (resource_id, created_by_name, created_by_kind, namespace) max(kompass_pod_info) by (container, pod, resource_id, created_by_name, created_by_kind, namespace)) by (container, resource_id, created_by_name, created_by_kind, namespace) or on (pod, container) max(kompass_pod_info) by (container, resource_id, created_by_name, created_by_kind, namespace) * 0
      - record: kompass_container_cpu_usage_p85_rate
        expr: quantile(0.85, rate(container_cpu_usage_seconds_total{container!="", pod!=""}[1m]) * on (pod, container) group_left (resource_id, created_by_name, created_by_kind, namespace) max(kompass_pod_info) by (container, pod, resource_id, created_by_name, created_by_kind, namespace)) by (container, resource_id, created_by_name, created_by_kind, namespace) or on (pod, container) max(kompass_pod_info) by (container, resource_id, created_by_name, created_by_kind, namespace) * 0
      - record: kompass_container_memory_usage_max
        expr: max(container_memory_working_set_bytes{container!="",pod!=""} * on (pod, container) group_left (resource_id, created_by_name, created_by_kind, namespace) max(kompass_pod_info) by (container, pod, resource_id, created_by_name, created_by_kind, namespace)) by (container, resource_id, created_by_name, created_by_kind, namespace) or on (pod, container) max(kompass_pod_info) by (container, resource_id, created_by_name, created_by_kind, namespace) * 0
      - record: kompass_container_memory_usage_p95
        expr: quantile(0.95, container_memory_working_set_bytes{container!="",pod!=""} * on (pod, container) group_left (resource_id, created_by_name, created_by_kind, namespace) max(kompass_pod_info) by (container, pod, resource_id, created_by_name, created_by_kind, namespace)) by (container, resource_id, created_by_name, created_by_kind, namespace) or on (pod, container) max(kompass_pod_info) by (container, resource_id, created_by_name, created_by_kind, namespace) * 0
      - record: kompass_container_memory_usage_p99
        expr: quantile(0.99, container_memory_working_set_bytes{container!="",pod!=""} * on (pod, container) group_left (resource_id, created_by_name, created_by_kind, namespace) max(kompass_pod_info) by (container, pod, resource_id, created_by_name, created_by_kind, namespace)) by (container, resource_id, created_by_name, created_by_kind, namespace) or on (pod, container) max(kompass_pod_info) by (container, resource_id, created_by_name, created_by_kind, namespace) * 0
      - record: kompass_container_cpu_usage_sum_rate
        expr: sum(rate(container_cpu_usage_seconds_total{container!="", pod!=""}[1m]) * on (namespace, pod, container) group_left (resource_id, created_by_name, created_by_kind) max(kompass_insights_pod_info) by (container, pod, resource_id, created_by_name, created_by_kind, namespace)) by (container, resource_id, created_by_name, created_by_kind, namespace) or on (namespace, pod, container) max(kompass_insights_pod_info) by (container, resource_id, created_by_name, created_by_kind, namespace) * 0
      - record: kompass_container_resource_requests_median
        expr: quantile(0.5, kube_pod_container_resource_requests * on(namespace,pod,container) group_left(resource_id,created_by_name,created_by_kind) max(kompass_insights_pod_info) by(container,pod,resource_id,created_by_name,created_by_kind,namespace)) by(container,resource_id,created_by_name,created_by_kind,namespace,resource) or on(namespace,pod,container) (max(kompass_insights_pod_info) by(container,resource_id,created_by_name,created_by_kind,namespace) * 0)
      - record: kompass_pod_startup_time
        expr: (kube_pod_status_ready_time - kube_pod_created) * on (pod, namespace) group_left (created_by_name, created_by_kind, resource_id) max by (pod, namespace, created_by_name, created_by_kind, resource_id) (kompass_pod_info)