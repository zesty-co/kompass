groups:
  - name: custom_rules
    rules:
      - record: kompass_container_cpu_usage_max_rate
        expr: max(rate(container_cpu_usage_seconds_total{container!="", pod!=""}[1m]) * on (pod, container) group_left (resource_id, created_by_name, created_by_kind, namespace) max(kompass_pod_info) by (container, pod, resource_id, created_by_name, created_by_kind, namespace)) by (container, resource_id, created_by_name, created_by_kind, namespace) or on (pod, container) max(kompass_pod_info) by (container, resource_id, created_by_name, created_by_kind, namespace) * 0
      - record: kompass_container_cpu_usage_p95_rate
        expr: quantile(0.95, rate(container_cpu_usage_seconds_total{container!="", pod!=""}[1m]) * on (pod, container) group_left (resource_id, created_by_name, created_by_kind, namespace) max(kompass_pod_info) by (container, pod, resource_id, created_by_name, created_by_kind, namespace)) by (container, resource_id, created_by_name, created_by_kind, namespace) or on (pod, container) max(kompass_pod_info) by (container, resource_id, created_by_name, created_by_kind, namespace) * 0
      - record: kompass_container_cpu_usage_p99_rate
        expr: quantile(0.99, rate(container_cpu_usage_seconds_total{container!="", pod!=""}[1m]) * on (pod, container) group_left (resource_id, created_by_name, created_by_kind, namespace) max(kompass_pod_info) by (container, pod, resource_id, created_by_name, created_by_kind, namespace)) by (container, resource_id, created_by_name, created_by_kind, namespace) or on (pod, container) max(kompass_pod_info) by (container, resource_id, created_by_name, created_by_kind, namespace) * 0
      - record: kompass_container_memory_usage_max
        expr: max(container_memory_working_set_bytes{container!="",pod!=""} * on (pod, container) group_left (resource_id, created_by_name, created_by_kind, namespace) max(kompass_pod_info) by (container, pod, resource_id, created_by_name, created_by_kind, namespace)) by (container, resource_id, created_by_name, created_by_kind, namespace) or on (pod, container) max(kompass_pod_info) by (container, resource_id, created_by_name, created_by_kind, namespace) * 0
      - record: kompass_container_memory_usage_p95
        expr: quantile(0.95, container_memory_working_set_bytes{container!="",pod!=""} * on (pod, container) group_left (resource_id, created_by_name, created_by_kind, namespace) max(kompass_pod_info) by (container, pod, resource_id, created_by_name, created_by_kind, namespace)) by (container, resource_id, created_by_name, created_by_kind, namespace) or on (pod, container) max(kompass_pod_info) by (container, resource_id, created_by_name, created_by_kind, namespace) * 0
      - record: kompass_container_memory_usage_p99
        expr: quantile(0.99, container_memory_working_set_bytes{container!="",pod!=""} * on (pod, container) group_left (resource_id, created_by_name, created_by_kind, namespace) max(kompass_pod_info) by (container, pod, resource_id, created_by_name, created_by_kind, namespace)) by (container, resource_id, created_by_name, created_by_kind, namespace) or on (pod, container) max(kompass_pod_info) by (container, resource_id, created_by_name, created_by_kind, namespace) * 0
